resources:
  jobs:
    iedr_ingestion_job:
      name: iedr_ingestion_job
      max_concurrent_runs: 2
      timeout_seconds: 3600
      schedule:
        quartz_cron_expression: "0 0 0 1 * ?"
        timezone_id: "America/New_York"
        pause_status: "UNPAUSED"
      tasks:
        - task_key: utility_1_ingestion_pipeline_task
          description: "Utility 1 Pipeline Task using Lakeflow Declarative Pipelines"
          pipeline_task:
            pipeline_id: ${resources.pipelines.utility_1_ingestion_pipeline.id}
          depends_on: []
          timeout_seconds: 3600
          max_retries: 2
          retry_on_timeout: false
        - task_key: utility_2_ingestion_pipeline_task
          description: "Utility 2 Pipeline Task using Lakeflow Declarative Pipelines"
          pipeline_task:
            pipeline_id: ${resources.pipelines.utility_2_ingestion_pipeline.id}
          depends_on: []
          timeout_seconds: 3600
          max_retries: 2
          retry_on_timeout: false
        - task_key: utility_1_transformation_pipeline_task
          description: "Utility 1 transformation pipeline Task using Lakeflow Declarative Pipelines"
          pipeline_task:
            pipeline_id: ${resources.pipelines.utility_1_transformation_pipeline.id}
          depends_on: [{"task_key": utility_1_ingestion_pipeline_task}]
          timeout_seconds: 3600
          max_retries: 2
          retry_on_timeout: false
          run_if: "ALL_SUCCESS"
        - task_key: utility_2_transformation_pipeline_task
          description: "Utility 2 transformation pipeline Task using Lakeflow Declarative Pipelines"
          pipeline_task:
            pipeline_id: ${resources.pipelines.utility_2_transformation_pipeline.id}
          depends_on: [ { "task_key": utility_2_ingestion_pipeline_task } ]
          timeout_seconds: 3600
          max_retries: 2
          retry_on_timeout: false
          run_if: "ALL_SUCCESS"
        - task_key: all_utility_transformation_pipeline_task
          description: "All utility transformation pipeline task using Lakeflow Declarative Pipelines"
          pipeline_task:
            pipeline_id: ${resources.pipelines.all_utility_union_pipeline.id}
          depends_on: [ { "task_key": utility_1_transformation_pipeline_task },
                        { "task_key": utility_2_transformation_pipeline_task } ]
          timeout_seconds: 3600
          max_retries: 2
          retry_on_timeout: false
          run_if: "ALL_SUCCESS"